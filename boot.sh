#!/bin/bash

# Repository variables
REPO_REF="${REPO_REF:-main}"
REPO_NAME="${REPO_NAME:-labs}"
REPO_AUTHOR="${REPO_AUTHOR:-noxtgm}"

# Colors
NC='\033[0m'
RED='\033[0;31m'
BLUE='\033[0;34m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BOLD_WHITE='\033[1;37m'

# ASCII logo
ascii_logo='
                                                  &&&&&&&&&                                                  
                                        &&&&&&X;;;;: ;;;&&&&&&&&&&&&&                                        
                                   &&&&  ;;;;;;;;;   ;;&&&&&&&&&X;;;;;&&&&                                   
                               &&& :      ;;;;;;;;;    &&&&&&&&;;;;;;;;;;;;&&&                               
                           &&&  ;;;;        :::;;;   ;x&&&&&&;;;;;;;;;;;;;;;;;;&&&                           
                         &&&   ;;;;;;       ;;;;;    ;&&&&&&X;;;;;;;;;;;;;;;;;;;;;&&                         
                      &&&&&&  ;;; :;;;   ;;;;;;;;;;;;;&&&&&&;;;;;;;;;;;;;;;;;;;;;;;;X&&                      
                    &&&&&&&& ;;   ;;;;  ;;;;;;;;;;;;;;&&&&&;;;;;;;;;;;;;;;;;;;;;;;;;;;;&&                    
                  &&&&&&&&&&        ;;;;;;;;;;;;;;;;;;&&&&&;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;&&                  
                &&   &&&&&&&&     ;;;;;;;;;;;;;;;;;;;;&&&&;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;&&                
               &&     &&&&&&&       ;;;;;;;;;;;;;;;;;;&&&&;;;  ;;  ;;;;;;;;;   ;;;;;;;;;;;;;X&               
             &&        &&&&&&&      ;;;;;;;; ;;: ;;;;;&&&;;;        ;;;;;;;:  ;;;;;;;;;;&&&&&&&&             
            &&           &&&&&&;;;;;;;;:    ; ;;;:  ;;&&&;;;    ;:     ;;;;;   ;;;;;;;&&&&&&&&&&&            
          &&              &&&&&&;;;;;       ;    ;;; ;&&& ;;;;;;;;;;;;;;;;;;;;  ;;;$&&&&&&&&&&&&&&           
         &&                 &&&&&;;;;             ;   &&x ;;;;;;;;;;;;;;;;;;;    &&&&&&&&&&&&&&&&&&&         
        &&                    &&&&$  ;;;;;;;;;        && : : ; ;;;:;;;;;;;;;;;;&&&&&&&&&;;;;;;;;;;;&&        
       &&                      x&&&&;;;;;;;;;;        &&        ;  ;;;;;;;;;;&&&&&&&;;;;;;;;;;;;;;;;&        
       &                     ;;;;&&&&;;;;;;;;;;;      &&          ;;;;;;;;;&&&&&&;;;;;;;;;;;;;;;;;;;;&       
      &&                    ;;;;;;;&&&;;;;;;;;;;;;;;  &&;;;;; ;;;;;;;;;;;&&&&&;;;;;;;;;;;;;;;;;;;;;;;X&      
     &&                    ;;;;;;;;;;&&&;;;;;;;;;;;;;;&$;;;;;;;;;;;;;;;X&&&;;;  ;;;;;;;;;;;;;;;;;;;;;;&&     
     &                   ;;;;;;;;;;;;;;&&;;;;;;;;;;;;;&;;;;;;;;;;; ;;;&&&;;;;;;   ;;;;;;;;;;;;;;;;;;;;;&     
    &&                 :;;;;;;;;;;;;;;;;;&&;;;;;;;;;;;&;;;;;;;;;;;; &&;;;;;;;;;;;   ; ;;;;;;;;;;;;;;;;;&&    
    &                 ;;;;;;;;;;;;;;;;;;;;;&;;;;;;;;;;$;;;;;;;;;;;&&  ;;;;;;;;;;;;;;;;;        ;;;;;;;;;&    
   &&&&              ;;;;;;;;;;;;;;;;;;;;;;;;&;;;;;;;;+;;;;;;;;;&$;;; ;;;;;;;;;;;;;;;;;;;        ;;;;;;;&&   
   &&&&&&             ;;;;;;;;;;;;;;;;;;;;;;;;&;;+XXXXXXXX&;;;+;;;;;;  :;;;;;;;;;;;;;;;             ;;;;&&   
   &&&&&&&&&          ;;;;;;;;;;;;;;;;;;;;;;;;;&XXXXXXXXXXXXX;;;;;;;;;   ;;;;;;;;;;;;;              ;;;;;&   
   &&&&&&&&&&&&&&&    ;;;;;;;;;;;;;;;;;;;;;;;;$XXXXXXXXXXXXXXX;;;;;;;;;   ;;;;;;;;;                  ;;;;&   
  &&&&&&&&&&&&&&&&&&&&&&&&x;;;;;;;;;;;;;;;;;;$XXXXXXXXXXXXXXXXX;;;;;;;;;; ;;;;;;                      ;;;&   
  &&   &&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&$XXXXXXXXXXXXXXXXX;;;;;;;;;;;;;                          ;;;&   
  &&                   ;;;;;;;;;;;;;;;;;;;;;;&XXXXXXXXXXXXXXXXX+$&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&X;&   
   &                    ;;;;;;;;;;;;;;;;;;;;;;XXXXXXXXXXXXXXXXx;;;;;;;;;;;;;;;;;;    &&&&&&&&&&&&&&&&&&&&&   
   &                     ;;;;;;;;;;;;;;;;;;;;;;XXXXXXXXXXXXXXx;;;;;;;;;;;;;;;;;;;            &&&&&&&&&&&&&   
   &&                      ;;;;;;;;;     ;;;;;&;;XXXXXXXXXX&;;;;;;;;;;;;;;;;;;;;                  &&&&&&&&   
   &&                                       &;;;;;;;;&&x;;;;;&;;;;;;;;;;;;;;;;                       &&&&&   
    &                                     && ;;;;;;;;x;;;;;;;;;&;;;;;;;;;;;;;                          &&    
    &&                                  &&  ;;;;;;;;;$;;;;;;;;;;;&;;;;;;;;;                            &&    
     &                               &&&    ;;;;;;;;;&;;;;;;;;;;; &&;;;;;                              &     
     &&                            &&&        ;;;;;;;&;;;;;;;;;;;;;;&&;;                              &&     
      &&                        &&&&&          ;;;;;;&+;;;;;;;;;;;;;;&&&                             &&      
       &                     &&&&&&            :;;;;;&X;;;;;;;;;;;;;;;;&&&                           &       
       &&                 &&&&&&&               ;;;;;&$;;;;;;;;;;;;;;;;;&&&&                        &        
        &&             &&&&&&&&                 ;;;;x&&;;;;;;;;;;;;;;;;; &&&&&                     &&        
         &&&      &&&&&&&&&&&                   ;;;;&&&;;;;;;;;;;;;;;;;;  &&&&&&                  &&         
          &&&&&&&&&&&&&&&&&                    ;;;;;&&&;;;;;;;;;;;;;;;;;    &&&&&&               &           
            &&&&&&&&&&&&&                     :;;;;;&&&;;;;;;;;;;;;;;;;;   ;;&&&&&&            &&            
             &&&&&&&&&                        ;;;;;&&&&;;;;;;;;;;;;;;      ;;;&&&&&&&         &&             
               &&&&&                            ;;;&&&&;;;;;;;;;;;;        ;;;;&&&&&&&      &&               
                &&                              ;;;&&&&;;;;;;;;;;;;       ;;;;  &&&&&&&    &&                
                  &&                             ;&&&&&;;;;;;;;;;;;       ;;;;  &&&&&&&& &&                  
                    &&                           ;&&&&&;;;;;;;;;;          ;     &&&&&&&&                    
                      &&&                        &&&&&$;;;;;;;;;;                &&&&&&                      
                         &&                     &&&&&&+;;;;;;;;;                &&&&                         
                           &&&&                &&&&&&&;;;;;;;;;               &&&&                           
                               &&&            &&&&&&&&;;;;;;;              &&&                               
                                   &&&&     &&&&&&&&&&                &&&&                                   
                                        &&&&&&&&&&&&&        &&&&&&&&                                        
                                                  &&&&&&&&&                                                  
'

clear

echo -e "\n$ascii_logo\n"
echo -e "${RED}[ERROR] Test.${NC}"
echo -e "${BOLD_WHITE}Welcome agent, please enter your password to begin the installation process.${NC}"
sudo pacman -Syu --noconfirm --needed git >/dev/null
rm -rf ~/.local/share/labs/

sleep 2
echo -e "\n${GREEN}[SUCCESS] Agent authentication successful.${NC}"
sleep 2
echo -e "\n${BLUE}[INFO] Initializing secure communication protocols...${NC}"
sleep 2
echo -e "\n${BLUE}[INFO] Establishing encrypted connection...${NC}"
sleep 4

clear

# Clone the default repository unless a specific repository is specified
echo -e "${BLUE}[INFO] Retrieving system components from:${NC} https://github.com/${REPO_AUTHOR}/${REPO_NAME}.git"
git clone "https://github.com/${REPO_AUTHOR}/${REPO_NAME}.git" ~/.local/share/labs >/dev/null

sleep 2

# Switch to the default branch unless a specific branch is specified
if [[ $REPO_REF != "main" ]]; then
    echo -e "\n${BLUE}[INFO] Switching to operational branch:${NC} $REPO_REF"
    cd ~/.local/share/labs
    git fetch origin "${REPO_REF}" && git checkout "${REPO_REF}"
    cd -
fi

echo -e "\n${GREEN}[SUCCESS] Repository secured. Beginning system deployment...${NC}"

sleep 4

clear

echo -e "${YELLOW}[WARNING] This system contains classified information. Unauthorized access is prohibited.${NC}\n"

sleep 3

# Begin the installation process
source ~/.local/share/labs/install.sh
